Public

**Manage B2B Scenarios Effectively with SAP Integration Suite**

Exercise 1

Vanes Coric, SAP AT

Marco Ertel, SAP SE

Janos Faluvegi, SAP HU

Table of ContentS

[0 Introduction](#introduction)

[1 Exercise 1: simple onboarding of a new Trading Partner](#exercise-1-simple-onboarding-of-a-new-trading-partner)

[1.1 Create new Trading Partner](#create-new-trading-partner)

[1.2 Use Agreement Template to create an agreement](#use-agreement-template-to-create-an-agreement)

[1.3 Prepare Simulation Flow and send a message](#prepare-simulation-flow-and-send-a-message)

[1.4 Monitor the Scenario](#monitor-the-scenario)

[2 Exercise 2: create new MIG](#_Toc153815178)

[3 Exercise 3: Create new MAG](#exercise-3-create-new-mag)

[4 Exercise 4: use new MIG and MAG](#exercise-4-use-new-mig-and-mag)

# Introduction

In this exercise, you will learn how to onboard a new Trading Partner by using the following capabilities of the Integration Suite:

-   Integration Advisor
-   Trading Partner Management
-   Cloud Integration

To make this session a successful one for all attendees, we recommend a good understanding of data structures (e. g. IDoc, SOAP, X12 or EDIFACT) along with some understanding of SAP Integration Suite capability Cloud Integration. The business process we will simulate in this exercise is part of the procure-to-pay process. The complete procure to pay consists of three transactions:

-   Purchase Order Request (Two-way transaction)
-   Shipment Notification
-   Invoice Message

Here we focus on the first transaction.

To make things easier no additional installations (like postman) are necessary. The EDIFACT ORDERS will be sent from an iFlow which acts as a simulator of the Trading Partner. There is also no real S/4HANA system connected but another iFlow which receives the IDoc Orders Message and responds with an ORDRSP IDoc sent via Process Direct to TPM. After TPM has handled the message again a simulated Trading Partner receives the ORDRSP message as an EDIFACT message over AS2 and sends the message to your personal mail inbox that you can verify.

To make exercise 1 easy, you will reuse already defined MIGs and MAGs. In the following exercises you will then create your own MIG and MAG. You simulate it to check if your mapping creates the expected results to use it in your transaction.

# Exercise 1: simple onboarding of a new Trading Partner

## Create new Trading Partner

Please logon to <https://opensapeu01.integrationsuite.cfapps.eu10-002.hana.ondemand.com/shell/home> with your UserXX. The password you will get from the Trainers.

To make all entities unique we recommend adding your user id like TradingPartner-**P123456** (if your userid is P123456). If your user is like *UserXX* so, please create then entities like TradingPartner-UserXX.

| Explanation                                                                                                                                                                                                                                                                                                                                                                                                                        | Screenshot                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
| Log on to the Integration Suite tenant with your system details provided to you by the app.                                                                                                                                                                                                                                                                                                                                        | ![](media/f84731f5b257c214fcb5106e7fa1a8e3.png)                                                |
| Navigate to *Design* and select *B2B Scenarios*.                                                                                                                                                                                                                                                                                                                                                                                   |  ![](media/9cff8c21ee57f5cfffc9574c199a6479.png)                                               |
| As you want to onboard a new Trading Partner switch to the tab *Trading Partners*.                                                                                                                                                                                                                                                                                                                                                 | ![](media/da09cd216ffc1e0418cb4d0262798107.png)                                                |
| Select *Create* to create a new Trading Partner.                                                                                                                                                                                                                                                                                                                                                                                   | ![](media/155be07b5f8b062b9a129a0d3a4905a9.png)                                                |
| On the following screen, you need to maintain general data for the new trading partner as follows: Company Name: *TradingPartner-P123456* (with *P123456* your userid) Company Short Name: *TradingPartnerXX* (with P123456 your user id) All the other fields are optional.                                                                                                                                                       |  ![](media/d6f7f1c5a52560dfb4b536ffeb5d6f39.png)                                               |
| Please save the newly created Trading Partner.                                                                                                                                                                                                                                                                                                                                                                                     | ![](media/d6f7f1c5a52560dfb4b536ffeb5d6f39.png)                                                |
| Switch to the *Contacts* tab and select *Create Contact*.                                                                                                                                                                                                                                                                                                                                                                          | ![](media/1a154d5af0d5bca4a4a14df8f38aa28c.png)![](media/b68eca3b89443cc0386050bd3ae83dd8.png) |
| On the *Contacts* tab, you can add names and details of persons who are responsible at the Trading Partner side.                                                                                                                                                                                                                                                                                                                   | ![](media/3660d7d1e9f73fdc6753a0ef6347e4c3.png)                                                |
| Navigate to the tab *Identifier* and create a *Single Identifier*.                                                                                                                                                                                                                                                                                                                                                                 | ![](media/4bb80309c34343903a6622b7d021f11a.png)                                                |
| Every Trading Partner needs at least two identifiers: one which is used in the exchange and a second one which is used in the S/4 System. Maintain the first identifier as follows: Use Identification *UNEDI_TP_E_P123456* (with *P123456* your user id), the same for the alias, select Type System  *UN/EDIFACT*,* *and Scheme *Duns (Dun & Bradstreet)*, then save the new identifier.                                         |  ![](media/1e59c139bddf5e65e024a6bc18f9f61a.png)                                               |
| Maintain the second Single Identifier as follows: Use Identification *O-P123456* (with *P123456* your user id), *the same* as Alias,  select Type *System SAP S/4HANA on Premise IDoc*, and Scheme *N/A*, then save the new identifier.                                                                                                                                                                                            |  ![](media/55024cb51226b4ff058c00bcd548faaa.png)                                               |
| In the security tab you need to add the partner ID which your trading partner will use to send the message. To make it simpler we use the same ID as in the step before. *O-P123456* (with P123456 your user id). Then save it.                                                                                                                                                                                                    | ![](media/154e316936135f497565aba6ef83ce92.png)                                                |
| As the AS2 Partner ID also need to be pushed to the Partner directory you need to activate it by clicking the activate toggle button.                                                                                                                                                                                                                                                                                              | ![](media/6b7f6fbaeabdb1ddcf31b526011a258a.png)                                                |
| The Business Context is currently optional, but we need to create a system where the supported type system and communication details must be maintained. Navigate to the tab *System* and select *Create System*.                                                                                                                                                                                                                  |  ![](media/5c554326089ed47088a9d13df0002452.png)                                               |
| Please add the following Details: Name *B2B-System-P123456* (with P123456 your user id), *B2B-System-P123456* (with P123456 your user id) as Alias, Type *B2B System*, Purpose *Dev *and save the new system.                                                                                                                                                                                                                      |  ![](media/7958bc5bb8ae443e1eb58ef2422b7fe3.png)                                               |
| Select the beforehand created system to create the supported Type System. On tab *Type System*, select *Create Type System*.                                                                                                                                                                                                                                                                                                       |  ![](media/64ff5c0fb0226fec60de910b05b3a008.png)                                               |
| Use *UN/EDIFACT* and Version D.02A S3, then save the new Type System.                                                                                                                                                                                                                                                                                                                                                              |  ![](media/6dfbe45030d8ab5fbb13e55748ee2c8c.png)                                               |
| Next, you need to maintain the communication details. Switch to tab *Communication* and select *Create Communication*.                                                                                                                                                                                                                                                                                                             | ![](media/1e2fe898c04337f00482b5792a1a4e6e.png)                                                |
| As this Trading Partner will send an Order via AS2 you need to create an AS2 Sender. Use in the Security Configuration Mode *Profile* and the AS2 Partner ID you’ve configured under the security tab.                                                                                                                                                                                                                             |  ![](media/914ef0e30495dbe6da8c996190b2f9d1.png)                                               |
| As the backend will send an ORDRSP message back, you also need to create another communication as this should be received by the Trading Partner (which will forward it then to you via mail). To create that, you need first to find out the url of the simulated trading partner on your tenant. For this first duplicate this tab to easily switch between screens, then navigate to the monitoring for *Integrations and APIs* |  ![](media/45ce70958473185323b6549da800120d.png)                                               |
| Click on the tile with *All*.                                                                                                                                                                                                                                                                                                                                                                                                      | ![](media/9764d04c3e6ccd8268598876a31abade.png)                                                |
| Search for *B2B-Partner-Simulator* and copy the url with the copy button. This url will end with *.com/as2/as2.* Do not use the url from the screenshot as your tenant might be a different one than the tenant from the screenshot.                                                                                                                                                                                               | ![](media/a3238cfe58e3900fd77dc22ee5eab057.png)                                                |
| Now jump back to TPM and there to your Trading Partner where you have to add another communication under the system tab. Use the names as you can see in the screenshot. For the recipient url you need to paste the url from the previous step. Please switch then to *Basic Authentication* with the Credential *ESB*.                                                                                                           | ![](media/2b446158dd26d939af0329b76f7ac415.png)                                                |
| Switch to the Tab *Processing* to enter to AS2 IDs, Subject and your mail address. Please use a mail address which works and where you can receive mails as the output will later be sent to that mail. It is mandatory that the Own AS2 looks like *OwnId-P123456* and the Partner AS2 Id like *PartnerId-P123456* (both times with P123456 as your user id). Then save the communication.                                        | ![](media/f75afd63eced4c43e3722b94c9d8620a.png)                                                |

## Use Agreement Template to create an agreement

With the Agreement, you instantiate the agreement template where you need to fill out the details of the trading partners.

| Explanation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Screenshot                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
| Navigate back to *Design à B2B Scenarios*, and switch to the tab *Agreements*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |  ![](media/e380e3c483df9fbb533b702995690c7b.png)  |
| On the *Agreements* tab, create a new Agreement.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  ![](media/e380e3c483df9fbb533b702995690c7b.png)  |
| In the upcoming dialog, select the existing Agreement *[openSAP - BTP4] Procure to Pay B2B Template* and select *Next*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  ![](media/4caa3f42cb62ed856b3113d10861ee34.png)  |
| Switch the Agreement Creation Mode to *Copy from Template*. (more details can be found in the documentation <https://help.sap.com/docs/integration-suite/sap-integration-suite/creating-trading-partner-agreement>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ![](media/193e858cb47e7b637de2744a8dd2f7ea.png)   |
| Deselect *Shipment Notification* and *Invoice Message* as in this simplified example we are only using the *Purchase Order Request Response.* Then select the *TradingPartner-P123456* (with *P123456* your userid) you’ve created and click on *Open Draft.*                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  ![](media/193e858cb47e7b637de2744a8dd2f7ea.png)  |
| Please start with renaming the Agreement to *Procure to Pay – P123456* (with P123456 your user id) and change the Description. Now you need to specify which Trading Partner Details you want to use. Please enter these details in the following order (with P123456 your user id): Maintain System *B2B-System-P123456*, Type System *UN/EDIFACT*, Type System Version *D.02A S3*, Identifier *UNEDI_TP_E_P123456*, and Identifier as Company *O-P123456*. Finally, select the Identifier as Trading Partner *123456789123* from the drop-down.  Hint: use the drop-down help but start with the Trading Partner Details and select the Identifier as Trading Partner as the last one. When done, save your settings. |  ![](media/37d5d145ec8266bbe7862f4e6433dc35.png)  |
| Navigate to the tab *B2B Scenarios* and switch the Transaction to the edit mode.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  ![](media/d107096923fdac02fd39f8e851696af1.png)  |
| There you see the transactions for the scenario. In our exercise, it is a two-way transaction initiated by the trading partner.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  ![](media/bdf066f39cd04d23739c22c48d29424f.png)  |
| Please start on the right by clicking on the first *Communication* box within the flow and select *AS2* for Communication.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ![](media/d6b81989f4a76c275cc7f17e1729b00e.png)   |
| Please click now on the *Interchange* box to define the Message Implementation Guideline. Select the drop-down list.  Note: The Message Implementation Guideline have been already prepared by using the Integration Advisor capability of SAP Integration Suite.                                                                                                                                                                                                                                                                                                                                                                                                                                                       |  ![](media/e8d6cffba097348ef1e597ee3570c505.png)  |
| In the pop up select *openSAP BTP4 - EDIFACT ORDERS* and switch to the highest version. Then select *Choose*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  ![](media/a63224a63bea5ad188edc5a9452a89da.png)  |
| Last step for the definition of the Order is to select the *Mapping* box (which is also prepared by using the Integration Advisor). Select the drop-down list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |  ![](media/bf6e8178ec07d841999e8351eae31990.png)  |
| In the pop up select *openSAP BTP4 - EDIFACT ORDERS to IDoc ORDERS* and switch to the highest version. Then select *Choose*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  ![](media/233b03b62bf9bd074b4614aacea485d7.png)  |
| As the backend will also send an Order Response the necessary data for these needs also to be maintained. Select the Communication for the outgoing message to *AS2.Receiver.*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ![](media/28f81d85c77d19d4e9d55b699407e194.png)   |
| Please click now on the *Interchange* box to define the Message Implementation Guideline. Select the drop-down list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |  ![](media/41de6ed41436a98be9911b667ef6de63.png)  |
| In the pop up select *openSAP BTP4 - EDIFACT ORDRSP* and switch to the highest version. Then select *Choose*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  ![](media/bd1abdf74fc29d3b051dd4614f70c5b2.png)  |
| Last step for the definition of the Order Response is to select the *Mapping* box Select the drop-down list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  ![](media/dcff13af1a76f8b043d98fdc10b0a427.png)  |
| In the pop up select *openSAP BTP4 – Idoc ORDRSP to EDIFACT ORDRSP* and switch to the highest version. Then select *Choose*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  ![](media/acdd59787a732c236461bd05c013ec68.png)  |
| Save the Agreement                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ![](media/0b548c906d4b229d9b6440c2a0a8ee94.png)   |
| Activate the agreement to write all necessary data into the Partner Directory Database.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ![](media/03b3828e96f1b3355b4ecca1e08f7729.png)   |

## Prepare Simulation Flow and send a message

As we have defined that the trading partner sends an EDIFACT Order via the AS2 Protocol we need to simulate this. Therefore, we have built an integration flow which you have to copy to a new package, configure it and deploy. The EDIFACT message is sent as soon as the integration flow is deployed.

| Explanation                                                                                                                                                                                                                                                                           | Screenshot                                       |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
| Navigate to *Design -\> Integrations and APIs*.                                                                                                                                                                                                                                       | ![](media/2652488f158d8b1c1fc5231ecc35af21.png)  |
| If you haven’t done so before, create a new Package by clicking *Create*.                                                                                                                                                                                                             | ![](media/270d4b8c82a9eff307ef08538c47884a.png)  |
| Use *openSAP-BTP4-P123456* for Name and Short Description with *XX* your user Id and *save* the package.                                                                                                                                                                              | ![](media/a42a9da3e3b5481fa238495c6c37898a.png)  |
| Navigate back to the list of existing packages by clicking *Integrations and APIs*.                                                                                                                                                                                                   |  ![](media/246af7747b72dcb0bcf3ee21cbb945e5.png) |
| Open the package *openSAP BTP - SimulatorFlow*.                                                                                                                                                                                                                                       | ![](media/3813a5671a4067f8be0772026d2f06d7.png)  |
| In the package, switch to tab *Artifacts*.                                                                                                                                                                                                                                            |  ![](media/58ea883ec680ad4022abeb52ceeada80.png) |
| Copy the integration flow *openSAP-Send-Purchase-Order* to your own package. Select *Copy* from the *Actions* menu of the *openSAP-Send-Purchase-Order* integration flow. **Important: please do not change or use or delete this iflow as this is the source for all participants!** | ![](media/6b4bc8699d58bced347fe791552f8798.png)  |
| In the popup, change the name to *openSAP-Send-Purchase-Order_P123456* (with *P123456* your User ID). Then choose *Select* to change the target package.                                                                                                                              |  ![](media/bdacbad3d3bb0706359cf2842e752d37.png) |
| In the upcoming package selection screen, select your package *openSAP-BTP4-P123456 (with P123456 your user id)*.                                                                                                                                                                     |  ![](media/9488339f9b6d5e846e315bb29e300d27.png) |
| Next, select *Copy*.                                                                                                                                                                                                                                                                  |  ![](media/cc65609f6c12ffbc30129f79e9d70074.png) |
| On the next dialog, select *Navigate* to open your package.                                                                                                                                                                                                                           | ![](media/ee19ae99d4e551b98f61a6f2c8d02c50.png)  |
| You now have to *Configure* the integration flow. Select *Configure* from the *Actions* menu of the *openSAP-Send-Purchase-Order_P123456* integration flow.                                                                                                                           |  ![](media/cf6b56493d3306142ae7098b6de645da.png) |
| Please configure the integration flow with your UserID *P123456*.  Then select *Save* and *Deploy*. Once the integration flow is successfully deployed, the message is sent and should appear in your mailbox a few seconds later.                                                    | ![](media/7da9583fc351ede310487e802c4bd42f.png)  |
| Please select the Confirmation message about transaction handling by selecting the checkmark.  The runtime profile is preselected as Cloud Integration and select deploy!                                                                                                             | ![](media/f79b3cfe8157e744e23da50fd13ecfc4.png)  |

## Monitor the Scenario

The EDIFACT message is now sent to the generic integration flow and from there via the IDOC Adapter to the simulated S/4HANA system which generates an ORDRSP. This is then mapped to EDIFACT and sent as an email to your inbox. To monitor B2B Scenarios let’s have a look at the B2B Monitoring.

| Explanation                                                                                                                                                                                                             | Screenshot                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
| Navigate to the B2B Monitoring by selecting *Monitor à B2B Scenarios*.                                                                                                                                                  | ![](media/a872147d68098348e6ae8517c8d89325.png) |
| On the tiles you see how many interchanges had been processed in the last 24 hours. Click on the left tile.                                                                                                             | ![](media/5a86330bbf836a108511128f6230a464.png) |
| Now you see all messages from the last 24 hours. You can restrict them by using the filters and activate the filter by pressing *Go*.                                                                                   | ![](media/719d712ecf6b2f2cc77e41eda3eaa629.png) |
| Click on one of your *Completed* interchanges. As we are using here a two-way transaction you will see for each started simulator iflow two entries: One for the Orders, one for the OrderRSP.                          | ![](media/87f6eea61cc21b139091baf31adaba13.png) |
| On this page, you see more details like Sender Name, Adapter Type, … and you can also jump to the technical monitoring if this is necessary, and you are also able to see the payload of the source and target message. | ![](media/0b47015bf26130de9ba6c9488d0b21f8.png) |
| Depending on the Event you’ve selected, you see here more details on a technical level to solve issues if necessary.                                                                                                    | ![](media/9b221d95c81e757cf4e24d097a296647.png) |

Congrats, you have successfully completed the first exercise.

# Exercise 2: create new MIG

In the next step you will create your own MIG. Your Trading Partner expects the following Order Response EDIFACT Message:

UNB+UNOC:3+1234567890123:1+UNEDI_TP_E_P123456:1+231217:1500+000255++++1'

UNH+5220230+ORDRSP:D:02A:UN:DF0320'

BGM++0000347163'

DTM+137:20231004:203'

LIN++5'

QTY+21:8.000:PCE'

PRI+INV:5250.00'

CUX+7:USD'

LIN++5'

QTY+21:8.000:PCE'

PRI+INV:4400.00'

CUX+7:USD'

LIN++5'

QTY+21:8.000:PCE'

PRI+INV:4884.00'

CUX+7:USD'

LIN++5'

QTY+21:8.000:PCE'

PRI+INV:5300.00'

CUX+7:USD'

UNS+S'

UNT+21+LS'

UNZ+1+000255'

As explained in week 2 unit 2, use that to create a MIG. As you already have a lot of knowledge about the Integration Suite the explanations will no longer be detailed as in the first exercise.

| Explanation                                                                                                                                                                                                                                               | Screenshot                                      |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
| Navigate to *Design* and select *MIGs*.                                                                                                                                                                                                                   | ![](media/bdd8fcf6b93666309d672aacdb540109.png) |
| Click on Add to create a new MIG. Use *UN/EDIFACT* as Type System and *ORDRSP* as Message with Version *D.02A S3* and skip the upload of sample xml.                                                                                                      |                                                 |
| Change the Name to *EDIFACT Ordrsp P123456* (with P123456 your userid). Use Direction *Both* and add in the Business Context the Business Process *Manage Purchase Order*. Then press the Button *Create*.                                                | ![](media/340ec766ef35ee582b5e266258d9d8af.png) |
| Now ask the proposal service how the structure normally looks like and compare the structure with the EDIFACT file you have seen at the beginning of this exercise and mark all necessary nodes and leafs. and also qualify wherever possible (e.g., DTM) | ![](media/41d457af3a88363f9ab2c7dfd7543c1d.png) |
| Qualify wherever possible (e.g., DTM). Do this by selecting the line and then right mouse click.                                                                                                                                                          | ![](media/fe22a8f5a18d06c1d1f165f34e497ae0.png) |
| Give the Nodes and leaves meaningful names. Add documentation where it is helpful and necessary by selecting the line and use the documentation area on the right                                                                                         | ![](media/f5936277d7a050ef61f544a1951ff664.png) |

If you’re finished your MIG do not forget to Save it as we will use it in the next exercises!

# Exercise 3: Create new MAG

In this exercise you have to create your own mapping to map from the IDoc Order Response Message to the EDIFACT OrdRsp Message. For each mapping you need a source and a target MIG. The source MIG has already been created by us and the target MIG had been created by yourself in the last exercise.

| Explanation                                                                                                                                                                                                                                                                                                                                                                                               | Screenshot                                      |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
| Navigate to *Design* and select *B2B Scenarios* and select *MAGs*.                                                                                                                                                                                                                                                                                                                                        | ![](media/bd276fd5c33db6f3323425d622bcaba0.png) |
| As you want to create a new MAG, please press *Add*                                                                                                                                                                                                                                                                                                                                                       | ![](media/254d8c7c67210e3c9e92d884a11a7541.png) |
| At first you have to select the source MIG. Use the prepared one: *openSAP BTP4 – IDoc ORDRSP.* Then click *Next.*                                                                                                                                                                                                                                                                                        | ![](media/8ecf772992e23e72064e0201788f0360.png) |
| Select as Target MIG the MIG you’ve created in the last exercise *EDIFACT Ordrsp P123456* (with P123456 your user id) and press *Create.*                                                                                                                                                                                                                                                                 | ![](media/254b334c58a4a373c1815258cc3149c8.png) |
| Now you get the proposals from the knowledge base with the Button *Proposal* and take the best proposals with the button *Select best proposals.* Then clear the Proposals (by clicking *Clear Proposal*) and save the MAG.                                                                                                                                                                               | ![](media/2d85ec51721237b0c0400a59af1cd6df.png) |
| Next simulate with the MAG with the IDoc you can download from discovery site “*ordrsp-idoc.xml*” using the *Simulate with Payload Data.*                                                                                                                                                                                                                                                                 | ![](media/82cad1ebd91733ec39c2b31bf504bae8.png) |
| It is very likely that you now run into an error message like this. If this error does not appear you will directly see the simulation results. Errors like this are coming mostly from mappings with xslt functions as these are also coming from the knowledge base. If this happens you have to search for the relevant mapping in the Mapping List with the filter function and switch only that off. | ![](media/3b4635256e49a20f9d55b8b60cb29d1d.png) |
| As the knowledge base also might propose xslt snippets for special purposes which want to access some global parameters (which are not existing in your mapping) this is the consequence. Therefore, delete this snippet. At first you have to find it like in the screenshot. Search for *CVM*. Select then the found line.                                                                              | ![](media/cbca9ef977addb6351dc6249e5ce659d.png) |
| This will show you the used function. As we want to keep the mapping but not that function, please replace it with: *\<xsl:sequence select="\$nodes_in/\*"/\>*                                                                                                                                                                                                                                            | ![](media/5c8eb35c12306ccd5ca983b4d84bb98a.png) |
| Try again the simulation. Very likely you will get now an additional column in source and target. Check all elements and compare with the edifact example at the beginning of the MIG exercise. Adjust the mapping till all elements are correct. On some elements you have to use constants (e.g., 0065, 0052, 0054, 0057) as not all necessary values are existing in the source.                       | ![](media/ae423896ebcea048b930150ca71231f8.png) |

# Exercise 4: use new MIG and MAG

After you’ve created now a MIG for the EDIFACT Order Response Message and a MAG to map from the IDoc Order Response to the Edifact message you need to change your trading partner agreement to use the newly created MIG and MAG.

| Explanation                                                                                                                                                                                                         | Screenshot                                      |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
| Navigate to the B2B Scenarios                                                                                                                                                                                       | ![](media/5b68f49d8f8d0807a253d4f11a99c628.png) |
| Go to Tab Agreements and open the Trading Partner Agreement you’ve created in exercise 1 (the name should be *Procure to Pay – P123456* with P123456 your user id)                                                  | ![](media/5ad12a4c15cad13f770ecad9c86b1756.png) |
| Switch from the Overview to the B2B Scenarios                                                                                                                                                                       | ![](media/13b904800f9ac295d2784a63e845a852.png) |
| And there to the edit mode.                                                                                                                                                                                         | ![](media/0b96027d1f3ae493cfdaadb8530f9496.png) |
| Select the Interchange in the second line (where the definition of the order response message is)                                                                                                                   | ![](media/2343bb0934e1aa0bcc6b6554d89c0e81.png) |
| Use the drop down to change the MIG and adapt the filter. Select your MIG (*EDIFACT Ordrsp P123456* with P123456 your user id) and click *Choose.*                                                                  | ![](media/54d9d6bbe667230f6f1036cbf120dd3d.png) |
| Now select the Mapping for the outgoing message.                                                                                                                                                                    | ![](media/c25ec67e48c8cdc048af3e659a7076d9.png) |
| Adapt the filter to you’re your MAG.Use here also the drop down to select a new MAG. (Name will be *Mapping openSAP BTP4 – Idoc ORDRSP to EDIFACT Ordrsp P123456* with P123456 your user id) and click on *Choose.* | ![](media/065b680f13a04fe377967184458a945f.png) |
| Save the Trading Partner Agreement                                                                                                                                                                                  | ![](media/ea2b808ae6bdedc9e12adddc30a1b48d.png) |
| Update your scenario                                                                                                                                                                                                | ![](media/50699178056457726eed845d1b2dfefe.png) |

Now you can again send a test message with the iflow you’ve copied in exercise 1 and look at the monitoring and in your personal inbox if everything works fine.
